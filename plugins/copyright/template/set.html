<!-- include tpl=head title=授权管理 -->
<script type="text/javascript" src="{func include_js}"></script>
<script type="text/javascript">
function check_save()
{
	//检查域名
	var rs = check_domain();
	if(!rs) return false;
	var code = $("#code").val();
	if(!code)
	{
		$.dialog.alert('注册码不能为空');
		return false;
	}
	return true;	
}

function check_domain()
{
	$("#domain_check").html('');
	var domain = $("#domain").val();
	if(!domain)
	{
		$.dialog.alert('域名不能为空');
		return false;
	}
	var ext = 'domain='+$.str.encode(domain);
	var tid = $("#tid").val();
	if(tid)
	{
		ext += "tid="+tid;
	}
	var url = api_plugin_url('copyright','domain',ext);
	var rs = json_ajax(url);
	if(rs.status != 'ok')
	{
		$.dialog.alert(rs.content);
		return false;
	}
	$("#domain_check").html('验证通过').css('color','darkgreen');
	return true;
}
function create_code()
{
	var rs = check_domain();
	if(!rs) return false;
	var domain = $("#domain").val();
	var date = $("#regdate").val();
	var str = $.md5((domain+date+Math.random()).toString());
	str = str.substr(3,16);
	str = str.toUpperCase();
	$("#code").val(str);
}
</script>
<div class="tips">
	<a href="{func admin_url plugin exec id=copyright&exec=manage}" title="域名授权管理">域名授权管理</a> &raquo;
	<!-- if $rs.id -->编辑<!-- else -->添加新<!-- /if -->授权
</div>
<form method="post" action="{func admin_url plugin exec id=copyright&exec=save}" onsubmit="return check_save()">
<input type="hidden" name="tid" id="tid" value="{$rs.id}" />
<div class="table">
	<div class="title">
		域名：
		<span class="note">请填写要备案的域名，请不要填写www，如您的域名是www.domain.com，请填写domian.com</span>
	</div>
	<div class="content">
		<input type="text" id="domain" name="domain" class="long" value="{$rs.domain}" />
		<input type="button" value="检测" onclick="check_domain()" class="button" />
		<span id="domain_check"></span>
	</div>
</div>
<div class="table">
	<div class="title">
		注册时间：
		<span class="note">请填写您的域名授权时间，请注意此项建议加完后不要修改</span>
	</div>
	<div class="content">
		<input type="text" id="regdate" name="regdate" class="default" value="{$rs.regdate ? date('Y-m-d',$rs.regdate) : date('Y-m-d',$app->time)}" onfocus="show_date('regdate',false)" />
	</div>
</div>
<div class="table">
	<div class="title">
		注册码：
		<span class="note">请设置好注册码，要求字母、数字组合，且字母要求大写，长度在10-16位</span>
	</div>
	<div class="content">
		<input type="text" id="code" name="code" class="long" value="{$rs.code}" />
		<input type="button" value="生成器" onclick="create_code()" class="btn" />
	</div>
</div>
<div class="table">
	<div class="title">
		授权类型：
		<span class="note"></span>
	</div>
	<div class="content">
		<table cellpadding="0" cellspacing="0">
		<tr>
			<td><label><input type="radio" name="type" id="type" value="LGPL"{if $rs.type == 'LGPL' || !$rs.type} checked{/if} />LGPL授权</label></td>
			<td>&nbsp; &nbsp;</td>
			<td><label><input type="radio" name="type" id="type" value="PBIZ"{if $rs.type == 'PBIZ'} checked{/if} />个人授权</label></td>
			<td>&nbsp; &nbsp;</td>
			<td><label><input type="radio" name="type" id="type" value="CBIZ"{if $rs.type == 'CBIZ'} checked{/if} />企业授权</label></td>
		</tr>
		</table>
	</div>
</div>
<div class="table">
	<div class="title">
		注册人：
		<span class="note">请填写注册人信息，如果是企业用户注册，请填写注册公司全称（包含市名）如：深圳XXX科技公司</span>
	</div>
	<div class="content">
		<input type="text" id="fullname" name="fullname" class="long" value="{$rs.fullname}" />
	</div>
</div>
<div class="table">
	<div class="title">
		程序版本：
		<span class="note">请填写授权的程序名及版本号，如phpok3.x，phpok4.x</span>
	</div>
	<div class="content">
		<input type="text" id="version" name="version" class="default" value="{$rs.version}" />
	</div>
</div>
<div class="table">
	<div class="title">
		Email：
		<span class="note">注册人联系邮箱</span>
	</div>
	<div class="content">
		<input type="text" id="email" name="email" class="default" value="{$rs.email}" />
	</div>
</div>
<div class="table">
	<div class="title">
		联系电话：
		<span class="note">请填写联系电话或手机号，如：0755-123456或15812345678</span>
	</div>
	<div class="content">
		<input type="text" id="phone" name="phone" class="default" value="{$rs.phone}" />
	</div>
</div>
<div class="table">
	<div class="title">
		联系QQ：
		<span class="note">如果您有客户的QQ联系信息，请填写在这里</span>
	</div>
	<div class="content">
		<input type="text" id="im" name="im" class="default" value="{$rs.im}" />
	</div>
</div>
<div class="table">
	<div class="title">
		文件MD5编码：
		<span class="note">此项由系统生成，请不要修改，用于验证文件MD5码是否符合要求</span>
	</div>
	<div class="content">
		<input type="text" id="md5file" name="md5file" class="long" value="{$rs.md5file}" />
	</div>
</div>
<div class="table">
	<div class="title">
		备注：
		<span class="note">填写一些备注，如果您需要的话</span>
	</div>
	<div class="content">
		<textarea name="note" id="note" class="long">{$rs.note}</textarea>
	</div>
</div>
<div class="table">
	<div class="content">
		<input type="submit" value="提 交" class="submit" />
	</div>
</div>
</form>
<!-- include tpl=foot -->