<!-- include tpl=head title=授权管理 -->
<script type="text/javascript">
function check_search()
{
	var k = $("#keywords").val();
	if(!k)
	{
		$.dialog.alert('请填写关键字进行搜索');
		return false;
	}
	return true;
}
function get_license(id)
{
	url = get_url('plugin','exec','id=copyright&exec=license&tid='+id);
	direct(url);
}
function edit_it(id)
{
	url = get_url('plugin','exec','id=copyright&exec=set&tid='+id);
	direct(url);
}
function delete_id(id,title)
{
	$.dialog.confirm('确定要删除授权域名：<span class="red">'+title+'</span> 吗?删除后是不能恢复的',function(){
		var url = get_url('plugin','exec','id=copyright&exec=delete&tid='+id);
		var rs = json_ajax(url);
		if(rs.status != 'ok')
		{
			if(!rs.content) rs.content = '删除失败';
			$.dialog.alert(rs.content);
			return false;
		}
		else
		{
			$.phpok.reload();
		}
	});
}
function set_status(id)
{
	if(!id)
	{
		$.dialog.alert("操作非法");
		return false;
	}
	var t = $("#status_"+id).attr('value');
	var url = get_url("plugin","exec","id=copyright&exec=status&tid="+id);
	var rs = json_ajax(url);
	if(rs.status == "ok")
	{
		var n_t = t == 1 ? 0 : 1;
		$("#status_"+id).removeClass("status"+t).addClass("status"+n_t);
		$("#status_"+id).attr("value",n_t);
		return true;
	}
	else
	{
		if(!rs.content) rs.content = "操作非法";
		$.dialog.alert(rs.content);
		return false;
	}
}
</script>
<div class="tips">
	<table width="100%">
	<tr>
		<td>域名授权管理</td>
		<td>
			<form method="post" action="{url ctrl=plugin func=exec id=copyright exec=manage/}" onsubmit="return check_search()">
			<input type="text" id="keywords" name="keywords" class="default" value="{$keywords}" />
			<input type="submit" value="搜索" class="submit" />
			</form>
		</td>
		<td align="right"><div class="action"><a href="{func admin_url plugin exec id=copyright&exec=set}" title="添加新授权">添加新授权</a></div></td>
	</tr>
	</table>
</div>
<div class="list">
<table width="100%" cellpadding="0" cellspacing="0" class="list">
<tr>
	<th width="20px">&nbsp;</th>
	<th class="lft">域名</th>
	<th class="lft">注册码</th>
	<th class="lft">注册版本</th>
	<th class="lft">注册方</th>
	<th class="lft">授权方式</th>
	<th width="220">操作</th>
</tr>
<!-- loop from=$rslist key=$key value=$value -->
<tr>
	<td><span class="status{$value.status}" id="status_{$value.id}" onclick="set_status({$value.id})" value="{$value.status}"></span></td>
	<td>{$value.domain}</td>
	<td><a href="http://license.phpok.com/{$value.code}" target="_blank">{$value.code}</a></td>
	<td>{$value.version}</td>
	<td>{$value.fullname}</td>
	<td>{$value.type == 'PBIZ' ? '个人授权' : ($value.type == 'CBIZ' ? '企业授权' : '开源授权')}</td>
	<td align="center">
		<input type="button" value="获取授权文件" onclick="get_license({$value.id})" class="btn" />
		<input type="button" value="编辑" onclick="edit_it({$value.id})" class="btn" />
		<input type="button" value="删除" onclick="delete_id({$value.id},'{$value.domain}')" class="btn" />
	</td>
</tr>
<!-- /loop -->
</table>
</div>
<!-- include tpl=pagelist -->
<!-- include tpl=foot -->